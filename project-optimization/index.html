<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>14.项目优化 | 黑马头条</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="16x16" href="/HeiMaTouTiao/images/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/HeiMaTouTiao/images/icons/favicon-32x32.png">
    <link rel="manifest" href="/HeiMaTouTiao/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/HeiMaTouTiao/images/icons/apple-touch-icon.png">
    <link rel="mask-icon" href="/HeiMaTouTiao/images/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="黑马头条项目的相关及文档">
    <meta name="application-name" content="VuePress">
    <meta name="apple-mobile-web-app-title" content="VuePress">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#3eaf7c">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/HeiMaTouTiao/assets/css/0.styles.48a771ad.css" as="style"><link rel="preload" href="/HeiMaTouTiao/assets/js/app.dfa1a733.js" as="script"><link rel="preload" href="/HeiMaTouTiao/assets/js/2.805c6e71.js" as="script"><link rel="preload" href="/HeiMaTouTiao/assets/js/22.8f56df4c.js" as="script"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/10.6f827b61.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/11.e86d8711.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/12.397448f3.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/13.da3bb227.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/14.47df3209.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/15.59cb257a.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/16.13398d16.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/17.aa49f2e5.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/18.c1377152.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/19.ff3e9320.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/20.f75adfeb.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/21.3ee07290.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/3.045195f7.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/4.a06c6df7.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/5.4e7b0cfb.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/6.15380c26.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/7.4667e2ea.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/8.4c41d83b.js"><link rel="prefetch" href="/HeiMaTouTiao/assets/js/9.bdc5e8d5.js">
    <link rel="stylesheet" href="/HeiMaTouTiao/assets/css/0.styles.48a771ad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/HeiMaTouTiao/" class="home-link router-link-active"><img src="https://vuejs.org/images/logo.svg" alt="黑马头条" class="logo"> <span class="site-name can-hide">黑马头条</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/HeiMaTouTiao/HeiMaTouTiao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://space.bilibili.com/36036472" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/VueProjectCourse/HeiMaTouTiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://toutiao.itheima.net/api.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  接口文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/HeiMaTouTiao/HeiMaTouTiao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://space.bilibili.com/36036472" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/VueProjectCourse/HeiMaTouTiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://toutiao.itheima.net/api.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  接口文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/HeiMaTouTiao/initial-project/" class="sidebar-link">1.初始化项目</a></li><li><a href="/HeiMaTouTiao/login/" class="sidebar-link">2.登录功能</a></li><li><a href="/HeiMaTouTiao/main-layout/" class="sidebar-link">3.主页布局</a></li><li><a href="/HeiMaTouTiao/article-list/" class="sidebar-link">4.文章列表</a></li><li><a href="/HeiMaTouTiao/feedback-operation/" class="sidebar-link">5.反馈操作</a></li><li><a href="/HeiMaTouTiao/channel-manager/" class="sidebar-link">6.频道管理</a></li><li><a href="/HeiMaTouTiao/article-search/" class="sidebar-link">7.文章搜索</a></li><li><a href="/HeiMaTouTiao/article-details/" class="sidebar-link">8.文章详情</a></li><li><a href="/HeiMaTouTiao/article-comment/" class="sidebar-link">9.文章评论</a></li><li><a href="/HeiMaTouTiao/profile/" class="sidebar-link">10.个人中心</a></li><li><a href="/HeiMaTouTiao/chat/" class="sidebar-link">11.小思同学</a></li><li><a href="/HeiMaTouTiao/page-permission-control/" class="sidebar-link">12.页面权限控制</a></li><li><a href="/HeiMaTouTiao/token-renew/" class="sidebar-link">13.Token 续签</a></li><li><a href="/HeiMaTouTiao/project-optimization/" aria-current="page" class="active sidebar-link">14.项目优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-保持组件的状态" class="sidebar-link">14.1 保持组件的状态</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-1-实现-main-组件的状态保持" class="sidebar-link">14.1.1 实现 Main 组件的状态保持</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-2-实现-home-组件的状态保持" class="sidebar-link">14.1.2 实现 Home 组件的状态保持</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-3-实现-searchresult-组件的状态保持" class="sidebar-link">14.1.3 实现 SearchResult 组件的状态保持</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-4-记录首页文章列表的滚动位置" class="sidebar-link">14.1.4 记录首页文章列表的滚动位置</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-5-解决-artlist-组件的-key-冲突问题" class="sidebar-link">14.1.5 解决 ArtList 组件的 key 冲突问题</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-6-记录文章详情页滚动的位置" class="sidebar-link">14.1.6 记录文章详情页滚动的位置</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-7-记录-searchresult-组件的滚动位置" class="sidebar-link">14.1.7 记录 SearchResult 组件的滚动位置</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-1-8-记录每个-tabs-的滚动位置" class="sidebar-link">14.1.8 记录每个 tabs 的滚动位置</a></li></ul></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-2-详情页代码高亮" class="sidebar-link">14.2 详情页代码高亮</a></li><li class="sidebar-sub-header"><a href="/HeiMaTouTiao/project-optimization/#_14-3-分支的合并与提交" class="sidebar-link">14.3 分支的合并与提交</a></li></ul></li><li><a href="/HeiMaTouTiao/build-package/" class="sidebar-link">15.打包发布</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_14-项目优化"><a href="#_14-项目优化" class="header-anchor">#</a> 14.项目优化</h1> <h2 id="_14-1-保持组件的状态"><a href="#_14-1-保持组件的状态" class="header-anchor">#</a> 14.1 保持组件的状态</h2> <blockquote><p>结合 vue 内置的 keep-alive 组件，可以实现组件的状态保持。
官方文档地址：https://cn.vuejs.org/v2/api/#keep-alive</p></blockquote> <h3 id="_14-1-1-实现-main-组件的状态保持"><a href="#_14-1-1-实现-main-组件的状态保持" class="header-anchor">#</a> 14.1.1 实现 Main 组件的状态保持</h3> <ol><li>在 <code>App.vue</code> 组件中，在 <code>&lt;router-view&gt;</code> 路由占位符之外包裹一层 <code>&lt;keep-alive&gt;</code> 组件，从而实现 <code>Main</code> 组件的状态保持：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 路由占位符 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li><p>通过步骤 1，的确实现了 <code>Main</code> 组件的状态保持。但是随之而来的：详情页也被缓存了，导致了文章数据不会动态刷新的问题。</p></li> <li><p>可以在 <code>ArticleDetail.vue</code> 组件中，定义 <code>watch</code> 侦听器来监视 <code>props</code> 中 <code>id</code> 值的变化，从而动态请求文章的详情数据：</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>watch<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只要 id 值发生了变化，就清空旧的文章信息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>article <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// 并重新获取文章的详情数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initArticleInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_14-1-2-实现-home-组件的状态保持"><a href="#_14-1-2-实现-home-组件的状态保持" class="header-anchor">#</a> 14.1.2 实现 Home 组件的状态保持</h3> <blockquote><p>点击 <code>tabBar</code> 实现 <code>Home</code> 页面和 <code>User</code> 页面切换展示的时候，发现 <code>Home</code> 组件的状态每次都会被刷新</p></blockquote> <ol><li>在 <code>Main.vue</code> 组件中，在 <code>&lt;router-view&gt;</code> 路由占位符之外包裹一层 <code>&lt;keep-alive&gt;</code> 组件，从而实现 <code>Home</code> 组件的状态保持：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 路由占位符 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- TabBar 区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar</span> <span class="token attr-name">route</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>home-o<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabbar-item</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-o<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>我的<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabbar</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>通过步骤 1，的确实现了 <code>Home</code> 组件的状态保持。但是随之而来的，<code>User.vue</code> 组件也被缓存了，导致修改用户头像后，头像不刷新的问题。</li> <li>可以在被缓存的 <code>User.vue</code> 组件中，声明 <code>activated</code> 和 <code>deactivated</code> 声明周期函数，来监听组件被激活和被缓存的状态变化：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 把下面这一行注释掉，因为 activated 在组件首次加载时也会调用一次</span>
  <span class="token comment">// this.initUserInfo()</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 被激活了</span>
<span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 只要组件被激活了，就重新初始化用户的信息</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_14-1-3-实现-searchresult-组件的状态保持"><a href="#_14-1-3-实现-searchresult-组件的状态保持" class="header-anchor">#</a> 14.1.3 实现 SearchResult 组件的状态保持</h3> <ol><li>在 <code>SearchResult.vue</code> 组件中，通过 <code>watch</code> 侦听器监视 <code>props</code> 中 <code>kw</code> 关键词的变化，从而动态请求文章的搜索结果：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>watch<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">kw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 重置关键数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>artList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">false</span>
    
    <span class="token comment">// 2. 请求数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSearchResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_14-1-4-记录首页文章列表的滚动位置"><a href="#_14-1-4-记录首页文章列表的滚动位置" class="header-anchor">#</a> 14.1.4 记录首页文章列表的滚动位置</h3> <blockquote><p>当 Home.vue 组件和 User.vue 进行切换展示时，需要记录 Home.vue 中文章列表的滚动位置</p></blockquote> <ol><li>在 <code>/src/router/index.js</code> 路由模块中，为 <code>Home</code> 组件的路由规则添加 <code>meta</code> 元信息：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{</span> isRecord<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>在 <code>Home.vue</code> 组件中，声明 <code>beforeRouteLeave</code> 这个组件内的守卫，用来记录当前组件在纵向上滚动的距离：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导航离开该组件的对应路由时调用</span>
<span class="token comment">// 可以访问组件实例 `this`</span>
<span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>在 <code>/src/router/index.js</code> 路由模块中，声明 <code>router.afterEach()</code> 这个全局后置钩子，用来读取路由元数据中的 <code>top</code> 值，并赋值给浏览器的滚动条：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 全局后置钩子</span>
router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果当前的路由的元信息中，isRecord 的值为 true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>isRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 则把元信息中的 top 值设为滚动条纵向滚动的位置</span>
      window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_14-1-5-解决-artlist-组件的-key-冲突问题"><a href="#_14-1-5-解决-artlist-组件的-key-冲突问题" class="header-anchor">#</a> 14.1.5 解决 ArtList 组件的 key 冲突问题</h3> <ol><li>导致问题的原因：
1.1  一进入 <code>ArtList.vue</code> 组件中，会立即触发 <code>created</code> 生命周期函数，请求文章列表的数据。
1.2  由于 <code>data</code> 中的 <code>loading</code> 值的默认值为 <code>false</code>，因此一进入页面，会立即触发一次 <code>&lt;van-list&gt;</code> 组件的 <code>load</code> 事件
1.3 这样就导致了发起重复请求的问题</li> <li>解决方案： 把 <code>ArtList.vue</code> 组件内的 <code>loading</code> 默认值，从 <code>false</code> 重置为 <code>true</code> 即可。</li> <li>这样，只通过 <code>created</code> 发起了首页的数据请求，并没有再次使用 <code>&lt;van-list&gt;</code> 额外请求数据。</li></ol> <h3 id="_14-1-6-记录文章详情页滚动的位置"><a href="#_14-1-6-记录文章详情页滚动的位置" class="header-anchor">#</a> 14.1.6 记录文章详情页滚动的位置</h3> <ol><li>在路由模块中，为文章详情页的路由规则添加路由元信息：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 文章详情的路由规则</span>
<span class="token punctuation">{</span> 
  path<span class="token operator">:</span> <span class="token string">'/article/:id'</span><span class="token punctuation">,</span> 
  component<span class="token operator">:</span> ArticleDetail<span class="token punctuation">,</span> 
  name<span class="token operator">:</span> <span class="token string">'art-detail'</span><span class="token punctuation">,</span> 
  props<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
  meta<span class="token operator">:</span> <span class="token punctuation">{</span> isRecord<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>在 <code>ArticleDetail.vue</code> 组件中，声明 <code>beforeRouteLeave</code> 这个组件内的守卫，用来记录当前组件在纵向上滚动的距离：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_14-1-7-记录-searchresult-组件的滚动位置"><a href="#_14-1-7-记录-searchresult-组件的滚动位置" class="header-anchor">#</a> 14.1.7 记录 SearchResult 组件的滚动位置</h3> <ol><li>在路由模块中，为搜索结果页的路由规则添加路由元信息：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 搜索结果页的路由规则</span>
<span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/search/:kw'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> SearchResult<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'search-result'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{</span> isRecord<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>在 <code>SearchResult.vue</code> 组件中，声明 <code>beforeRouteLeave</code> 这个组件内的守卫，用来记录当前组件在纵向上滚动的距离：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_14-1-8-记录每个-tabs-的滚动位置"><a href="#_14-1-8-记录每个-tabs-的滚动位置" class="header-anchor">#</a> 14.1.8 记录每个 tabs 的滚动位置</h3> <blockquote><p>当 Home.vue 组件中的频道选中项发生变化的时候，需要记录每个频道下列表的滚动位置。</p></blockquote> <ol><li>在 <code>/src/views/Home/Home.vue</code> 组件中，为 <code>&lt;van-tabs&gt;</code> 绑定 <code>before-change</code> 属性：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 频道列表的标签页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabs</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sticky</span> <span class="token attr-name">offset-top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.22666667rem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:before-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beforeTabsChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 循环渲染用户的频道 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tab</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in userChannel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>art-list</span> <span class="token attr-name">:channel-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>art-list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tab</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabs</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>在 <code>Home.vue</code> 组件中定义名为 <code>nameToTop</code> 的对象，用来存储频道名称和滚动条位置之间的对应关系：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// “频道名称”和“滚动条位置”之间的对应关系，格式 { '推荐': 211, 'html': 30, '开发者资讯': 890 }</span>
<span class="token keyword">const</span> nameToTop <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>在 <code>Home.vue</code> 组件的 <code>methods</code> 中定义 <code>beforeTabsChange</code> 方法：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// tabs 发生切换之前，触发此方法</span>
<span class="token function">beforeTabsChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 把当前&quot;频道名称&quot;对应的&quot;滚动条位置&quot;记录到 nameToTop 对象中</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">]</span><span class="token punctuation">.</span>name
  nameToTop<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY

  <span class="token comment">// return true 表示允许进行标签页的切换</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>在 <code>/src/views/Home/Home.vue</code> 组件中，为 <code>&lt;van-tabs&gt;</code> 绑定 <code>change</code> 属性：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 频道列表的标签页 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tabs</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sticky</span> <span class="token attr-name">offset-top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.22666667rem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:before-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beforeTabsChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTabsChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 循环渲染用户的频道 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-tab</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in userChannel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>art-list</span> <span class="token attr-name">:channel-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>art-list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tab</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-tabs</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="5"><li>在 <code>Home.vue</code> 组件的 <code>methods</code> 中定义 <code>onTabsChange</code> 方法：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当 tabs 切换完毕之后，触发此方法</span>
<span class="token function">onTabsChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 等 DOM 更新完毕之后，根据记录的&quot;滚动条位置&quot;，调用 window.scrollTo() 方法进行滚动</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">]</span><span class="token punctuation">.</span>name
    window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> nameToTop<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_14-2-详情页代码高亮"><a href="#_14-2-详情页代码高亮" class="header-anchor">#</a> 14.2 详情页代码高亮</h2> <blockquote><p>基于 highlight.js 美化详情页的代码片段</p></blockquote> <ol><li>运行如下的命令，在项目中安装 <code>highlight.js</code>：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i highlight.js@10.6.0 -S
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>在 <code>index.html</code> 页面的 <code>&lt;head&gt;</code> 标签中引入 <code>highlight.js</code> 的样式表：</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.staticfile.org/highlight.js/10.6.0/styles/default.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>在 <code>ArticleDetail.vue</code> 组件中导入 <code>highlight.js</code> 模块：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 导入 highlight.js 模块</span>
<span class="token keyword">import</span> hljs <span class="token keyword">from</span> <span class="token string">'highlight.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>在 <code>ArticleDetail.vue</code> 组件的 <code>updated</code> 声明周期函数中，对位置内容进行高亮处理：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 当组件的 DOM 更新完毕之后</span>
<span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 2. 判断是否有文章的内容</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>article<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 3. 对文章的内容进行高亮处理</span>
    hljs<span class="token punctuation">.</span><span class="token function">highlightAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_14-3-分支的合并与提交"><a href="#_14-3-分支的合并与提交" class="header-anchor">#</a> 14.3 分支的合并与提交</h2> <ol><li>将修改过后的文件加入暂存区，并进行本地的 <code>commit</code> 提交：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -m <span class="token string">&quot;完成了项目优化&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>将本地的 <code>optimize</code> 分支首次推送到 <code>Gitee</code> 仓库中：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> push -u origin optimize
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>将本地的 <code>optimize</code> 分支合并到本地的 <code>master</code> 主分支，并推送 <code>master</code> 分支到 <code>Gitee</code> 仓库：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> checkout master
<span class="token function">git</span> merge optimize
<span class="token function">git</span> push
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>删除本地的 <code>optimize</code> 子分支：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> branch -d optimize
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="5"><li>基于 <code>master</code> 主分支，新建 <code>publish</code> 分支，准备实现项目的打包发布：</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> checkout -b publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/HeiMaTouTiao/token-renew/" class="prev">
        13.Token 续签
      </a></span> <span class="next"><a href="/HeiMaTouTiao/build-package/">
        15.打包发布
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/HeiMaTouTiao/assets/js/app.dfa1a733.js" defer></script><script src="/HeiMaTouTiao/assets/js/2.805c6e71.js" defer></script><script src="/HeiMaTouTiao/assets/js/22.8f56df4c.js" defer></script>
  </body>
</html>
